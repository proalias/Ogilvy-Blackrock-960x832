<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <link href="./s/styles.css" rel="stylesheet" type="text/css" />


    <title>Blackrock</title>
    <script type="text/javascript" src="./j/easeljs-0.7.0.min.js"> </script>
    <script type="text/javascript" src="./j/tweenjs-0.5.0.min.js"> </script>
    <script type="text/javascript" src="./j/movieclip-0.7.0.min.js"> </script>

</head>
<body onload="setup();">
    <div class="canvasHolder">
            <canvas id="stage" width="960" height="832"></canvas>
    </div>
</body>

<script>


    var stage;

    //images
    var upImages = [];
    var downImages = [];
    var chevron;

    //switches
    var started = false;

    //state
    var currentSection;


    //timings
    var t_upBeginFrame      =  55000;
    var t_downBeginFrame    = 100000;
    var t_chevronBeginFrame = 155000;
    var t_ctaBeginFrame     = 240000;


    //setup

    function setup(){
        currentSection = -1;
        stage = new createjs.Stage("stage");
        createjs.Ticker.addEventListener("tick", handleTick);
    }

    function setupUpSequence(){

        stage.removeAllChildren();

        for (var i=0;i<9;i++){
            var image = new createjs.Bitmap("./i/up.png");
            stage.addChild(image);
            upImages.push(image);
        }
    }


    function setupDownSequence(){

        stage.removeAllChildren();

        for (i=0;i<10;i++){
            var image = new createjs.Bitmap("./i/down.png");
            stage.addChild(image);
            downImages.push(image);
        }
    }


    function setupChevronSequence(){
        stage.removeAllChildren();
        chevron = new createjs.Bitmap("./i/chevron.png");
        stage.addChild(chevron);
    }

    function setupCTASequence(){

    }





    // Javascript doesn't have built-in support for ranges
    // Insted we use arrays of two elements to represent ranges
    var mapRange = function(from, to, s) {
        return to[0] + (s - from[0]) * (to[1] - to[0]) / (from[1] - from[0]);
    };


    function handleTick(event) {
        if (started == false){
            startTime = event.time;
            started = true;
        }

        var section = Math.round(mapRange([startTime, t_ctaBeginFrame],[0,4],event.time));

        if (section != currentSection){
            //section changed - do setup
            switch (section){
                case 0:
                    setupUpSequence();
                    break;
                case 1:
                    setupDownSequence();
                    break;
                case 2:
                    setupChevronSequence();
                    break;
                case 3:
                    setupCTASequence();
                    break;
            }
            currentSection = section;
        }

        switch (section){
            case 0:
                updateUpSequence();
                break;
            case 1:
                updateDownSequence();
                break;
            case 2:
                updateChevronSequence();
                break;
            case 3:
                updateCTASequence();
                break;
        }

        stage.update();
    }

    function updateDownSequence(){
        for (var i=0;i<9;i++){
            var image = downImages[i];
            image.x += 10 * (0.1 * i);
            image.y -= 10 * (0.1 * i);
        }
    }

    function updateUpSequence(){
        for (var i=0;i<9;i++){
            var image = upImages[i];
            image.x += 10 * (0.1 * i);
            image.y -= 10 * (0.1 * i);
        }
    }

    function updateChevronSequence(){
        chevron.x += 10;
    }

    function updateCTASequence(){
        var bar = 0;
        var foo = bar;
    }


</script>


</html>